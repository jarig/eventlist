{% extends 'party/party.html' %}
{% load i18n %}
{% load static %}
{% load filters %}
{% get_static_prefix as STATIC_PREFIX %}
{% load field_renderer %}

{% block includes %}
    {{ block.super }}
    <link href="{{ STATIC_URL }}address/css/address.less" rel="stylesheet/less" type="text/css">
    <link href="{{ STATIC_URL }}common/css/forms.css" rel="stylesheet" type="text/css">
    <link href="{{ STATIC_URL }}css/party.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="{{ STATIC_URL }}address/address.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/party.js"></script>
    {% include "jquery.multiselect.html" %}
    {% include "jquery.timeentry.html" %}
    {{ createPartyForm.media }}
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script type="text/javascript">
        Party.init();
    </script>
{% endblock %}

{% block content %}

    <div class="container-fluid">
        <form action="{%  url party.views.credit %}" method="POST">
            {{ eventSchedulesFormSet.management_form }}
            <input type="hidden" value="{% url common.views.findAddress %}" id="findAddressUrl">
            <div class="row-fluid">
                <div class="buttonPane">
                    <a href="#" class="btn">{% trans "Submit" %}</a>
                </div>
            </div>
            <div class="row-fluid partyHeader">
                <div class="formControl {% if createPartyForm.name.errors %}errorHighlight{% endif %}">
                    {% field createPartyForm.name 'title=Party Name' 'class=wideinput' %}
                </div>
                <div class="errors">
                    {{ createPartyForm.name.errors }}
                </div>
            </div>
            <div class="row-fluid">

                <div class="span3">
                    <div class='divButton'>
                        <div class="partyLogo">
                            {% field createPartyForm.logo "render=preview" %}
                            {{ createPartyForm.logo }}
                        </div>
                    </div>
                    <div class='logoUploadLabel'>
                        {% field createPartyForm.logo "render=upload" %}
                    </div>
                    <div class="errors">
                        {{ createPartyForm.logo.errors }}
                    </div>
                </div>
                <div class="span9">
                    <div class="partyParticipantBox">
                        <div class="partyParticipantActions">
                            <div class="partyParticipantInviteButton divButton">
                                <i class="icon-plus"></i>
                                {% trans "Invite Participants" %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="btn-toolbar row-fluid partyScheduleHeader">
                <div class="sectionHeader float-left">
                </div>
                <div class="btn-group float-right" id="partyScheduleMenu">
                    <a class="btn btn-small btn-info" id="addCustomScheduleButton" href="#">
                        <i class="icon-plus icon-white"></i>
                        {% trans "Add Custom Event" %}
                    </a>
                    <button class="btn btn-small btn-info dropdown-toggle" data-toggle="dropdown">
                        <span class="caret">
                        </span>
                    </button>
                    <ul class="dropdown-menu">
                        <input type="hidden" id="searchEventURL" value="{% url event.views.searchEvent %}">
                        <li><a href="#" id="searchEventButton">Find Event</a></li>
                        <li><a href="#">External Event</a></li>
                    </ul>
                </div>
            </div>
        <div id="scheduleForms" action-bind="ajaxForm">
            {% for partySchedule in customPartyScheduleFormSet %}
                <div class="row-fluid partySchedule well">
                    <input id="is_bound" value="{{ partySchedule.is_bound }}" type="hidden">
                    {{ partySchedule.id }}
                    {{ partySchedule.DELETE.as_hidden }}
                    {{ partySchedule.ORDER.as_hidden }}
                    <div class="row-fluid">
                        <a class="close" action-bind="closeButton">&times;</a>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            {{ partySchedule.location }}
                        </div>
                        <div id="editable" class="span7">
                            {{ partySchedule.eventSchedule }}
                            {{ partySchedule.url }}
                            {{ partySchedule.dateFrom }}
                            {{ partySchedule.timeFrom }}
                            {{ partySchedule.dateTo }}
                            {{ partySchedule.timeTo }}
                        </div>
                    </div>
                </div>
            {% endfor %}
            {{ customPartyScheduleFormSet.management_form }}
            <input type="hidden" value="{{ customPartyScheduleFormSet.prefix }}" id="formPrefix">
        </div>

        <div class="row-fluid">
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">{% trans "Create Party" %}</button>
                <button class="btn">{% trans "Cancel" %}</button>
            </div>
        </div>
        </form>
        {{ customPartyScheduleFormSet.errors }}
        {{ createPartyForm.errors }}
    </div>
    <!-- Custom Schedule -->
    <div class="modal hide" id="customSchedulePopup">
        <div class="modal-header">
            <a class="close" data-dismiss="modal">Ã—</a>
            <h3>{% trans "Add Custom Schedule" %}</h3>
        </div>
        <div class="modal-body container-fluid">
            <div class="row-fluid">
            </div>
            <div class="clear"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary span2" autocomplete="off"
                    data-complete-text="{% trans "Added" %}"
                    data-loading-text="{% trans "Adding..." %}"
                    id="addButton">
                {% trans "Add" %}
            </button>
            <a href="#" class="btn span2" data-dismiss="modal" autocomplete="off">
                {% trans "Close" %}
            </a>
        </div>
    </div>
{% endblock %}

{% block hiddenContent %}

{% endblock %}