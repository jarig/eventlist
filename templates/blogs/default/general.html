{% extends 'blogs/default/design.html' %}
{% load i18n %}
{% load field_renderer %}

{% block includes %}
   {{ block.super }}
   <link href="{{ STATIC_URL }}css/blogs_create.css" rel="stylesheet" type="text/css">
   <script src="{{ STATIC_URL }}js/blogs_create.js" type="text/javascript"></script>
   <script src="{{ STATIC_URL }}address/address.js" type="text/javascript"></script>
   <link href="{{ STATIC_URL }}blogs_default/css/create.css" rel="stylesheet" type="text/css">
   <link href="{{ STATIC_URL }}css/blogs_address.css" rel="stylesheet" type="text/css">
   {% include 'jqueryPlugins/pagination.inc' %}
   {% include 'jqueryPlugins/googlemaps.inc' %}
{% endblock %}


{% block scripts %}
    {{ block.super }}
    <script type="text/javascript">
        {% if blogForm and accessType >= accessTypes.ADMIN %}
            BlogForm.initCreate();

            Address.init('.addressForm','{% url common.views.getCities %}',
                    function()
                    {
                        Address.refreshGoogleMap('.addressForm', GoogleMaps.moveAndMark);
                    });
            $(function()
            {
                $("#showMap").click(function()
                {
                   $('#addresses').toggle();
                   GoogleMaps.init('#googleMap');
                   if ( $("#googleMap").is(":visible") )
                        Address.refreshGoogleMap('.addressForm', GoogleMaps.moveAndMark);
                   return false;
                });
            });//TODO move to class
        {% endif %}
    </script>
{% endblock %}



{% block logoBottom %}
    {% if blogForm %}
        <a href="#" onclick="CommonGUI.openUploadWindow('#uploadDialog','#blogLogoSrc','#id_logo');">Upload</a>
    {% endif %}
{% endblock logoBottom%}

{% block hiddenContent %}
    {% if blogForm %}
    <div id="uploadDialog">
        <iframe src="{% url common.views.uploadTempImage %}" id="uploadLogoFrame" width="100%" height="100%">
        </iframe>
    </div>
    {% endif %}
{% endblock %}


{% block formDefinition %}
        {% if blogForm and accessLevel >= accessLevels.ADMIN  %}
        <form id="blogData"
              {% if blogForm.instance.id %}
              action="{% url blogs.views.edit  blogForm.instance.id None %}"
              {% else %}
              action="{% url blogs.views.create %}"
              {% endif %}
        enctype="multipart/form-data" method="POST">
        {{ blogForm.logo }}
        <input type="hidden" id="blog_id" value="{{ blogForm.instance.id }}">
        <div class="buttonPane">
            <span><a href="{% url blogs.views.manage %}">{{"<< Back"|escape}}</a></span>
            <span>
            <a href="#" onclick="BlogForm.submit('#blogData');">
                {% if blogForm.instance.id %}
                    {% trans 'Save' %}
                {% else %}
                    {% trans 'Create' %}
                {% endif %}
            </a>
            </span>

            {% if blogForm.instance.id %}
                <span>
                    <a href="{% url blogs.views.view  blogForm.instance.id page %}" target="_blank">View Blog</a>
                </span>
            {% endif %}

            <div style="float:right; ">
                <a href="#">Blog Style</a> |
                {{ blogForm.style }}
            </div>
        </div>
        {% endif %}
{% endblock %}

{% block blogNameHeader %}
    {% if blogForm and accessLevel >= accessLevels.ADMIN %}
        <div class="divButton blogNameHeader">
            {% field blogForm.name 'title=Blog Name' 'class=blogNameHeader'%}
        </div>
        <div class="errors">
            {{ blogForm.name.errors }}
        </div>
    {% else %}
        <div class="blogNameHeader">
            <div class='blogNameHeader'>{{ blog.name }}</div>
        </div>
    {% endif %}
{% endblock %}

{% block blogHeaderImages %}
    <!--div class="divButton" onclick="" style="line-height: 60px;">
        <h3>Add here few images</h3>
    </div-->
{% endblock %}

{% block blogModule_1 %}
    {% if adrFormSet %}
        <div class="addressesHeader">
            <a href="#" id="showMap">
                Map</a>
        </div>
        <div class="addresses" id="addresses">
            {% for form in adrFormSet %}
                <div id="{{ forloop.counter }}" class="addressForm">
                    {% include 'event_address.html' with address=form %}
                </div>
            {% endfor %}
            {{ adrFormSet.management_form }}
            <!--div class="button"><a href="#">Add More</a></div-->
            <!--div id="paginator"></div-->
        </div>
        <div id="googleMap" style="width: 100%; height: 200px; border: 1px #e6e6fa solid; display:none;">
        </div>
    {% endif %}
{% endblock %}

{% block blogDescription %}
    {% if blogForm and accessLevel >= accessLevels.ADMIN %}
        <div class="divButton" style="line-height: 60px;">
            {% field blogForm.description 'title=Add short description of your blog' 'class=blogDescription'%}
        </div>
        <div class="errors">
            {{ blogForm.description.errors }}
        </div>
    {% else %}
        {# view mode #}
        <div class="blogDescription" >
            <p>
                {{ blog.description|escape|linebreaksbr }}
            </p>
        </div>
    {% endif %}
{% endblock %}


{% block blogFacilities %}

    {% if blogForm and accessLevel >= accessLevels.ADMIN %}
        <div class="formField">
            <div class="fieldLabel">{% trans 'Facilities' %}:</div>
            <div class="fieldInput">
                {{ blogForm.facilities }}
            </div>
            <div class="fieldRight">
                <a href="#" id="addNewBlogType">Add New</a>
            </div>
            <div class="fieldError errors">
                {{ blogForm.facilities.errors }}
            </div>
        </div>
    {% else %}
        {# if in view mode #}
        {% for type in blog.facilities.all %}
            <div class="blogType">
                {{ type.name }}
            </div>
        {% endfor %}
    {% endif %}
{% endblock %}


{% block blogNews %}
    <div id="blogNews">
        News Here
        {{ blogForm.errors }}
    </div>
{% endblock %}



{% block formEnd %}
    {% if blogForm and accessLevel >= accessLevels.ADMIN %}
        </form>
    {% endif %}
{% endblock %}